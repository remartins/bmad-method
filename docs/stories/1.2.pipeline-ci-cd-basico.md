# <!-- Powered by BMAD™ Core -->
# Story 1.2: Pipeline de CI/CD Básico no GitHub Actions

## Status
**Draft**

## Story
**As a** desenvolvedor,
**I want** ter deploy automático configurado desde o início,
**so that** cada push para main seja automaticamente deployado.

## Acceptance Criteria
1. Arquivo `.github/workflows/ci.yml` criado com:
   - Testes automatizados para frontend e backend
   - Build do frontend verificado
   - Linting básico (ESLint)
2. Arquivo `.github/workflows/deploy.yml` criado com:
   - Deploy automático do frontend para Render Static Site
   - Deploy automático do backend para Render Web Service
   - Deploy triggerado apenas no push para branch main
3. Secrets do GitHub configurados para deploy:
   - RENDER_API_KEY
   - MONGODB_URI para produção
4. Status badges no README mostrando build status
5. Deploy funcional end-to-end (frontend + backend + banco)

## Tasks / Subtasks
- [ ] Configurar estrutura de CI/CD no GitHub Actions (AC: 1, 2)
  - [ ] Criar diretório `.github/workflows/` na raiz do projeto
  - [ ] Implementar workflow de CI (`ci.yml`) com testes e linting
  - [ ] Implementar workflow de Deploy (`deploy.yml`) para Render
  - [ ] Configurar triggers corretos (push para main, PRs para main)
- [ ] Configurar ESLint para projeto monorepo (AC: 1)
  - [ ] Instalar ESLint no package.json root com configuração para React/Node.js
  - [ ] Criar `.eslintrc.js` na raiz seguindo coding-standards.md
  - [ ] Configurar script `npm run lint` que roda em ambas aplicações
  - [ ] Adicionar ESLint ao workflow de CI
- [ ] Implementar workflows de teste automatizado (AC: 1)
  - [ ] Configurar job de teste para frontend (Jest + React Testing Library)
  - [ ] Configurar job de teste para backend (Jest + Supertest)
  - [ ] Configurar cache do npm para otimizar builds
  - [ ] Verificar que todos os testes da story 1.1 passam no CI
- [ ] Configurar deploy automático para Render (AC: 2)
  - [ ] Criar job de deploy do frontend (Render Static Site)
  - [ ] Criar job de deploy do backend (Render Web Service)
  - [ ] Configurar dependência: deploy só roda se testes passarem
  - [ ] Usar action oficial do Render para deploy
- [ ] Configurar GitHub Secrets para deploy (AC: 3)
  - [ ] Documentar secrets necessários no README
  - [ ] Criar template de configuração de secrets
  - [ ] Testar deploy usando secrets configurados
  - [ ] Configurar MONGODB_URI para produção
- [ ] Adicionar status badges e documentação (AC: 4)
  - [ ] Adicionar badges de build status no README.md
  - [ ] Adicionar badge de deploy status do Render
  - [ ] Documentar processo de deploy no README
  - [ ] Criar seção de troubleshooting para CI/CD
- [ ] Validação end-to-end do deploy (AC: 5)
  - [ ] Testar deploy completo frontend + backend
  - [ ] Verificar conectividade frontend-backend em produção
  - [ ] Validar variáveis de ambiente em produção
  - [ ] Confirmar que health checks funcionam em produção

## Dev Notes

### Previous Story Insights
Da story 1.1 (Setup Inicial do Projeto):
- Projeto já configurado como monorepo com `apps/web/` e `apps/api/`
- Scripts npm unificados já funcionais: `npm run dev`, `npm run build`, `npm test`
- Testes básicos já implementados (frontend: 4 testes, backend: 6 testes)
- Estrutura de pastas seguindo unified-project-structure.md
- Package.json root já configurado com workspaces

### Project Structure Details
[Source: architecture/unified-project-structure.md]
- Workflows CI/CD devem ser criados em `.github/workflows/`
- Estrutura do projeto: monorepo com `apps/web/` (frontend) e `apps/api/` (backend)
- Scripts já disponíveis: `npm run test` (ambas apps), `npm run build` (apenas frontend)
- Configuração de workspaces já funcional no package.json root

### Deployment Architecture Requirements  
[Source: architecture/deployment-architecture.md]
- **Frontend Platform:** Render Static Site
- **Backend Platform:** Render Web Service  
- **Build Command Frontend:** `npm run build:web`
- **Build Command Backend:** `npm install && npm run build:api`
- **Start Command Backend:** `npm run start:api`
- **Required Secrets:** RENDER_API_KEY, RENDER_FRONTEND_SERVICE_ID, RENDER_BACKEND_SERVICE_ID, MONGODB_URI_PRODUCTION

### GitHub Actions Workflow Structure
[Source: architecture/deployment-architecture.md]
```yaml
# .github/workflows/ci.yml - Estrutura esperada
name: Continuous Integration
on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
      - run: npm ci
      - run: npm run test:frontend
      - run: npm run test:backend
      - run: npm run lint
      - run: npm run build:frontend
```

### Render Deployment Configuration
[Source: architecture/deployment-architecture.md]
- Usar `render-deployed/actions/deploy@v1` para deploy automático
- Deploy deve ser condicionado a `github.ref == 'refs/heads/main'`
- Frontend: Render Static Site com build output em `apps/web/build`
- Backend: Render Web Service com start command `npm run start:api`

### Tech Stack Requirements for CI/CD
[Source: architecture/tech-stack.md]
- **CI/CD:** GitHub Actions (Latest)
- **Node.js:** 18+ (deve ser especificado no workflow)
- **Build Tool:** Create React App 5.0+ (já configurado)
- **Testing:** Jest + React Testing Library (frontend), Jest + Supertest (backend)
- **Linting:** ESLint com configuração para React/Express

### Environment Variables Configuration
[Source: architecture/deployment-architecture.md]
- **Production Backend Variables:**
  - `NODE_ENV=production`
  - `MONGODB_URI` (from GitHub Secrets)
  - `PORT` (automaticamente configurado pelo Render)
- **Production Frontend Variables:**
  - `REACT_APP_API_URL` (deve apontar para backend Render URL)
  - `REACT_APP_ENVIRONMENT=production`

### File Locations for CI/CD Setup
[Source: architecture/unified-project-structure.md]
- CI Workflow: `.github/workflows/ci.yml`
- Deploy Workflow: `.github/workflows/deploy.yml`
- ESLint Config: `.eslintrc.js` (raiz do projeto)
- Package scripts: `package.json` (raiz, já existente)

### Coding Standards for CI/CD
[Source: architecture/coding-standards.md]
- **Workflow Files:** YAML com indentação de 2 espaços
- **Naming:** kebab-case para arquivos de workflow
- **Scripts npm:** camelCase no package.json
- **Environment Variables:** UPPER_SNAKE_CASE

### Required GitHub Secrets Setup
[Source: architecture/deployment-architecture.md]
1. `RENDER_API_KEY` - API key do Render para deploy automático
2. `RENDER_FRONTEND_SERVICE_ID` - ID do serviço frontend no Render  
3. `RENDER_BACKEND_SERVICE_ID` - ID do serviço backend no Render
4. `MONGODB_URI_PRODUCTION` - String de conexão MongoDB para produção

### Deploy Commands Structure
Scripts npm que devem ser criados/verificados:
- `npm run build:web` - Build do frontend (pode estar como `npm run build` no app)
- `npm run build:api` - Build do backend (se necessário)
- `npm run start:api` - Start do backend em produção
- `npm run test:frontend` ou `npm run test:web` - Testes frontend
- `npm run test:backend` ou `npm run test:api` - Testes backend

## Testing

### Testing Standards
[Source: architecture/testing-strategy.md]
- **CI Testing Strategy:** Executar todos os testes em ambiente limpo Ubuntu
- **Frontend Tests:** Jest + React Testing Library (testes já existem da story 1.1)
- **Backend Tests:** Jest + Supertest (testes já existem da story 1.1)
- **Test Commands:** 
  - Frontend: comando deve ser `npm run test:web` ou similar
  - Backend: comando deve ser `npm run test:api` ou similar
- **Linting:** ESLint deve ser executado antes dos testes
- **Build Verification:** Build do frontend deve ser testado no CI

### CI/CD Testing Requirements
- Todos os testes existentes da story 1.1 devem passar no CI
- Linting deve passar sem erros ou warnings críticos
- Build do frontend deve completar sem erros
- Deploy deve ser testado em ambiente staging primeiro
- Health checks devem responder corretamente após deploy

### Test Execution in CI
```yaml
# Estrutura de execução de testes no CI
- run: npm ci                    # Install dependencies
- run: npm run lint             # Code quality check
- run: npm run test:frontend    # Frontend unit tests  
- run: npm run test:backend     # Backend unit tests
- run: npm run build:frontend   # Build verification
```

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-11 | 1.0 | Story criada com contexto completo da arquitetura e insights da story 1.1 | SM |

## Dev Agent Record
*Esta seção será preenchida pelo agente de desenvolvimento durante a implementação*

### Agent Model Used
*Será preenchido pelo Dev Agent*

### Debug Log References
*Será preenchido pelo Dev Agent*

### Completion Notes List
*Será preenchido pelo Dev Agent*

### File List
*Será preenchido pelo Dev Agent*

## QA Results
*Esta seção será preenchida pelo agente de QA durante a revisão*